<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç”»åƒã‚’é«˜å“è³ªã®ã¾ã¾è»½é‡åŒ–ã€‚JPEGãƒ»PNGãƒ»WebPå¯¾å¿œã€‚ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã›ãšãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã™ã‚‹ãŸã‚å®‰å…¨ã€‚ç„¡æ–™ã®ç”»åƒåœ§ç¸®ãƒ„ãƒ¼ãƒ«ã€‚">
    <meta name="keywords" content="ç”»åƒåœ§ç¸®,ç”»åƒè»½é‡åŒ–,JPEGåœ§ç¸®,PNGåœ§ç¸®,WebPå¤‰æ›,ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="ç”»åƒåœ§ç¸® - WebToolBox">
    <meta property="og:description" content="ç”»åƒã‚’é«˜å“è³ªã®ã¾ã¾è»½é‡åŒ–ã€‚ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã›ãšå®‰å…¨ã«å‡¦ç†ã§ãã‚‹ç„¡æ–™ãƒ„ãƒ¼ãƒ«ã€‚">
    <link rel="canonical" href="https://webtoolbox.example.com/tools/image-compressor.html">
    <title>ç”»åƒåœ§ç¸® | ç„¡æ–™ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç”»åƒè»½é‡åŒ–ãƒ„ãƒ¼ãƒ« - WebToolBox</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ–¼ï¸</text></svg>">
    <style>
        .drop-zone {
            border: 3px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--gray-50);
        }
        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }
        .drop-zone-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        .drop-zone-text {
            font-size: 18px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }
        .drop-zone-hint {
            font-size: 14px;
            color: var(--gray-400);
        }
        .image-preview-container {
            display: none;
            margin-top: 24px;
        }
        .image-preview-container.show {
            display: block;
        }
        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .preview-grid {
                grid-template-columns: 1fr;
            }
        }
        .preview-card {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: 16px;
        }
        .preview-card h3 {
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: 12px;
            text-align: center;
        }
        .preview-image {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: contain;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }
        .preview-stats {
            margin-top: 12px;
            text-align: center;
        }
        .preview-size {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-800);
        }
        .preview-dimensions {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 4px;
        }
        .compression-result {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 24px;
            border-radius: var(--radius);
            text-align: center;
            margin-top: 20px;
        }
        .compression-percent {
            font-size: 48px;
            font-weight: 800;
        }
        .compression-label {
            font-size: 16px;
            opacity: 0.9;
        }
        .quality-preview {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 8px;
        }
        .quality-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            min-width: 60px;
        }
        .format-select {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .format-btn {
            padding: 10px 20px;
            border: 2px solid var(--gray-200);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        .format-btn.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }
        .batch-list {
            margin-top: 20px;
        }
        .batch-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: var(--radius);
            margin-bottom: 12px;
        }
        .batch-item img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        .batch-item-info {
            flex: 1;
        }
        .batch-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .batch-item-size {
            font-size: 13px;
            color: var(--gray-500);
        }
        .batch-item-result {
            text-align: right;
        }
        .batch-item-saving {
            color: var(--secondary);
            font-weight: 700;
        }
    </style>
</head>
<body class="tool-page">
    <!-- Header -->
    <header class="site-header">
        <div class="header-content">
            <a href="../" class="logo">
                <span class="logo-icon">ğŸ§°</span>
                <span>WebToolBox</span>
            </a>
            <nav>
                <ul class="nav-links">
                    <li><a href="../">ãƒ„ãƒ¼ãƒ«ä¸€è¦§</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Tool Header -->
    <section class="tool-header">
        <h1>ğŸ–¼ï¸ ç”»åƒåœ§ç¸®</h1>
        <p>ç”»åƒã‚’é«˜å“è³ªã®ã¾ã¾è»½é‡åŒ–</p>
    </section>

    <!-- Main Content -->
    <main class="tool-content">
        <div class="tool-main">
            <!-- Drop Zone -->
            <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                <div class="drop-zone-icon">ğŸ“</div>
                <div class="drop-zone-text">ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
                <div class="drop-zone-hint">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰</div>
                <input type="file" id="fileInput" accept="image/*" multiple hidden>
            </div>

            <!-- Options -->
            <div class="form-group" style="margin-top: 24px;">
                <label class="form-label">å‡ºåŠ›å½¢å¼</label>
                <div class="format-select">
                    <button class="format-btn active" data-format="jpeg" onclick="setFormat('jpeg')">JPEG</button>
                    <button class="format-btn" data-format="png" onclick="setFormat('png')">PNG</button>
                    <button class="format-btn" data-format="webp" onclick="setFormat('webp')">WebP</button>
                </div>
            </div>

            <div class="form-group" id="qualityGroup">
                <label class="form-label">å“è³ª</label>
                <div class="quality-preview">
                    <input type="range" id="qualitySlider" class="range-input" min="10" max="100" value="80" oninput="updateQuality()">
                    <span class="quality-value" id="qualityValue">80%</span>
                </div>
                <p style="font-size: 13px; color: var(--gray-500); margin-top: 8px;">
                    ä½ã„å€¤ = ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå° / é«˜ã„å€¤ = é«˜å“è³ª
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">ãƒªã‚µã‚¤ã‚ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                    <div>
                        <input type="number" id="maxWidth" class="form-input" placeholder="æœ€å¤§å¹…" style="width: 120px;">
                        <span style="color: var(--gray-500);"> Ã— </span>
                        <input type="number" id="maxHeight" class="form-input" placeholder="æœ€å¤§é«˜ã•" style="width: 120px;">
                        <span style="color: var(--gray-500);"> px</span>
                    </div>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="keepAspect" checked>
                        <span>ç¸¦æ¨ªæ¯”ã‚’ç¶­æŒ</span>
                    </label>
                </div>
            </div>

            <!-- Single Image Preview -->
            <div class="image-preview-container" id="singlePreview">
                <div class="preview-grid">
                    <div class="preview-card">
                        <h3>åœ§ç¸®å‰</h3>
                        <img id="originalImage" class="preview-image" alt="Original">
                        <div class="preview-stats">
                            <div class="preview-size" id="originalSize">-</div>
                            <div class="preview-dimensions" id="originalDimensions">-</div>
                        </div>
                    </div>
                    <div class="preview-card">
                        <h3>åœ§ç¸®å¾Œ</h3>
                        <img id="compressedImage" class="preview-image" alt="Compressed">
                        <div class="preview-stats">
                            <div class="preview-size" id="compressedSize">-</div>
                            <div class="preview-dimensions" id="compressedDimensions">-</div>
                        </div>
                    </div>
                </div>

                <div class="compression-result" id="compressionResult">
                    <div class="compression-percent" id="compressionPercent">-</div>
                    <div class="compression-label">å‰Šæ¸›</div>
                </div>

                <div class="btn-group" style="margin-top: 20px; justify-content: center;">
                    <button class="btn btn-primary" onclick="downloadImage()">
                        ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                    <button class="btn btn-secondary" onclick="resetTool()">
                        ğŸ”„ åˆ¥ã®ç”»åƒã‚’åœ§ç¸®
                    </button>
                </div>
            </div>

            <!-- Batch Preview -->
            <div class="image-preview-container" id="batchPreview">
                <h3 style="margin-bottom: 16px;">åœ§ç¸®çµæœ</h3>
                <div class="batch-list" id="batchList"></div>
                <div class="compression-result" id="batchResult">
                    <div class="compression-percent" id="batchPercent">-</div>
                    <div class="compression-label">åˆè¨ˆå‰Šæ¸›</div>
                </div>
                <div class="btn-group" style="margin-top: 20px; justify-content: center;">
                    <button class="btn btn-primary" onclick="downloadAllImages()">
                        ğŸ“¥ ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                    <button class="btn btn-secondary" onclick="resetTool()">
                        ğŸ”„ åˆ¥ã®ç”»åƒã‚’åœ§ç¸®
                    </button>
                </div>
            </div>
        </div>

        <!-- Ad Space -->
        <div class="ad-container horizontal">
            <span>åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹ (728x90)</span>
        </div>

        <!-- Info Section -->
        <div class="info-box">
            <h2>ç”»åƒåœ§ç¸®ãƒ„ãƒ¼ãƒ«ã®ç‰¹å¾´</h2>
            <ul>
                <li><strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·</strong> - ç”»åƒã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãšã€ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†</li>
                <li><strong>è¤‡æ•°å½¢å¼å¯¾å¿œ</strong> - JPEGã€PNGã€WebPã«å¤‰æ›å¯èƒ½</li>
                <li><strong>å“è³ªèª¿æ•´</strong> - ç”¨é€”ã«åˆã‚ã›ã¦åœ§ç¸®ç‡ã‚’èª¿æ•´</li>
                <li><strong>ä¸€æ‹¬å‡¦ç†</strong> - è¤‡æ•°ç”»åƒã‚’åŒæ™‚ã«åœ§ç¸®</li>
                <li><strong>ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½</strong> - ç”»åƒã‚µã‚¤ã‚ºã®ç¸®å°ã‚‚å¯èƒ½</li>
            </ul>
        </div>

        <!-- Tips -->
        <div class="info-box">
            <h2>å½¢å¼ã®é¸ã³æ–¹</h2>
            <ul>
                <li><strong>JPEG</strong> - å†™çœŸå‘ã‘ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ãã€Webè¡¨ç¤ºã«æœ€é©</li>
                <li><strong>PNG</strong> - é€éãŒå¿…è¦ãªå ´åˆã€‚ãƒ­ã‚´ã‚„ã‚¢ã‚¤ã‚³ãƒ³ã«æœ€é©</li>
                <li><strong>WebP</strong> - æœ€æ–°å½¢å¼ã€‚JPEGã‚ˆã‚Š30%ç¨‹åº¦å°ã•ãã€é€éã‚‚å¯¾å¿œ</li>
            </ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="../">ãƒ›ãƒ¼ãƒ </a>
                <a href="../#tools">ãƒ„ãƒ¼ãƒ«ä¸€è¦§</a>
            </div>
            <p class="copyright">&copy; 2024 WebToolBox. All rights reserved.</p>
        </div>
    </footer>

    <script src="../js/common.js"></script>
    <script>
        let currentFormat = 'jpeg';
        let compressedImages = [];
        let originalFiles = [];

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
        function handleFiles(files) {
            const imageFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
            if (imageFiles.length === 0) {
                showToast('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }

            originalFiles = imageFiles;
            compressedImages = [];

            if (imageFiles.length === 1) {
                processSingleImage(imageFiles[0]);
            } else {
                processBatchImages(imageFiles);
            }
        }

        // å˜ä¸€ç”»åƒå‡¦ç†
        async function processSingleImage(file) {
            const original = await loadImage(file);
            const compressed = await compressImage(original, file.type);

            document.getElementById('originalImage').src = original.src;
            document.getElementById('compressedImage').src = compressed.dataUrl;

            document.getElementById('originalSize').textContent = formatFileSize(file.size);
            document.getElementById('originalDimensions').textContent = `${original.width} Ã— ${original.height} px`;

            document.getElementById('compressedSize').textContent = formatFileSize(compressed.size);
            document.getElementById('compressedDimensions').textContent = `${compressed.width} Ã— ${compressed.height} px`;

            const reduction = ((1 - compressed.size / file.size) * 100).toFixed(1);
            document.getElementById('compressionPercent').textContent = reduction + '%';
            document.getElementById('compressionResult').style.background = 
                reduction > 0 ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';

            compressedImages = [{ name: file.name, dataUrl: compressed.dataUrl }];

            document.getElementById('singlePreview').classList.add('show');
            document.getElementById('batchPreview').classList.remove('show');
            dropZone.style.display = 'none';
        }

        // ãƒãƒƒãƒå‡¦ç†
        async function processBatchImages(files) {
            const batchList = document.getElementById('batchList');
            batchList.innerHTML = '';
            
            let totalOriginal = 0;
            let totalCompressed = 0;

            for (const file of files) {
                const original = await loadImage(file);
                const compressed = await compressImage(original, file.type);
                
                totalOriginal += file.size;
                totalCompressed += compressed.size;

                const reduction = ((1 - compressed.size / file.size) * 100).toFixed(1);

                compressedImages.push({ 
                    name: file.name.replace(/\.[^.]+$/, '') + '.' + currentFormat, 
                    dataUrl: compressed.dataUrl 
                });

                batchList.innerHTML += `
                    <div class="batch-item">
                        <img src="${compressed.dataUrl}" alt="${file.name}">
                        <div class="batch-item-info">
                            <div class="batch-item-name">${file.name}</div>
                            <div class="batch-item-size">${formatFileSize(file.size)} â†’ ${formatFileSize(compressed.size)}</div>
                        </div>
                        <div class="batch-item-result">
                            <div class="batch-item-saving">-${reduction}%</div>
                        </div>
                    </div>
                `;
            }

            const totalReduction = ((1 - totalCompressed / totalOriginal) * 100).toFixed(1);
            document.getElementById('batchPercent').textContent = totalReduction + '%';

            document.getElementById('batchPreview').classList.add('show');
            document.getElementById('singlePreview').classList.remove('show');
            dropZone.style.display = 'none';
        }

        // ç”»åƒèª­ã¿è¾¼ã¿
        function loadImage(file) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.src = URL.createObjectURL(file);
            });
        }

        // ç”»åƒåœ§ç¸®
        function compressImage(img, originalType) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                let width = img.width;
                let height = img.height;

                // ãƒªã‚µã‚¤ã‚º
                const maxWidth = parseInt(document.getElementById('maxWidth').value) || Infinity;
                const maxHeight = parseInt(document.getElementById('maxHeight').value) || Infinity;
                const keepAspect = document.getElementById('keepAspect').checked;

                if (width > maxWidth || height > maxHeight) {
                    if (keepAspect) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width = Math.round(width * ratio);
                        height = Math.round(height * ratio);
                    } else {
                        width = Math.min(width, maxWidth);
                        height = Math.min(height, maxHeight);
                    }
                }

                canvas.width = width;
                canvas.height = height;

                // èƒŒæ™¯ã‚’ç™½ã«ï¼ˆé€éç”»åƒã®JPEGå¤‰æ›ç”¨ï¼‰
                if (currentFormat === 'jpeg') {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                }

                ctx.drawImage(img, 0, 0, width, height);

                const quality = parseInt(document.getElementById('qualitySlider').value) / 100;
                const mimeType = currentFormat === 'jpeg' ? 'image/jpeg' : 
                               currentFormat === 'png' ? 'image/png' : 'image/webp';

                const dataUrl = canvas.toDataURL(mimeType, quality);
                const size = Math.round((dataUrl.length - 22) * 3 / 4);

                resolve({ dataUrl, size, width, height });
            });
        }

        // å½¢å¼è¨­å®š
        function setFormat(format) {
            currentFormat = format;
            document.querySelectorAll('.format-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-format="${format}"]`).classList.add('active');

            // PNGå½¢å¼ã§ã¯å“è³ªè¨­å®šã¯åŠ¹æœãªã—
            document.getElementById('qualityGroup').style.opacity = format === 'png' ? '0.5' : '1';

            // å†åœ§ç¸®
            if (originalFiles.length > 0) {
                handleFiles(originalFiles);
            }
        }

        // å“è³ªæ›´æ–°
        function updateQuality() {
            const value = document.getElementById('qualitySlider').value;
            document.getElementById('qualityValue').textContent = value + '%';

            // ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã§å†åœ§ç¸®
            clearTimeout(window.qualityTimeout);
            window.qualityTimeout = setTimeout(() => {
                if (originalFiles.length > 0) {
                    handleFiles(originalFiles);
                }
            }, 300);
        }

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadImage() {
            if (compressedImages.length > 0) {
                const img = compressedImages[0];
                const link = document.createElement('a');
                link.download = img.name.replace(/\.[^.]+$/, '') + '.' + currentFormat;
                link.href = img.dataUrl;
                link.click();
                showToast('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
            }
        }

        // å…¨ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadAllImages() {
            compressedImages.forEach((img, index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.download = img.name;
                    link.href = img.dataUrl;
                    link.click();
                }, index * 200);
            });
            showToast(`${compressedImages.length}å€‹ã®ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰`);
        }

        // ãƒªã‚»ãƒƒãƒˆ
        function resetTool() {
            originalFiles = [];
            compressedImages = [];
            fileInput.value = '';
            document.getElementById('singlePreview').classList.remove('show');
            document.getElementById('batchPreview').classList.remove('show');
            dropZone.style.display = 'block';
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
    </script>
</body>
</html>
